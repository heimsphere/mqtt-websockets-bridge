LIBWS_PATH=`brew --prefix libwebsockets`
LIBEV_PATH=`brew --prefix libev`
MOSQUITTO_PATH=`brew --prefix mosquitto`
SRC=llog.c subscriber.c ws.c mqtt.c bridge.c message.c

ALL=bridge echo_service

default: $(ALL)

clean:
	rm -f $(ALL)

format:
	uncrustify -c ../uncrustify.linux.cfg --replace *.c
	
memcheck:
	leaks `pidof bridge`


bridge: clean
	gcc -g -pedantic -Wall -o bridge $(SRC) \
		-DEXTERNAL_POLL \
		-I$(LIBWS_PATH)/include/ -L$(LIBWS_PATH)/lib -lwebsockets \
		-I$(MOSQUITTO_PATH)/include/ -L$(MOSQUITTO_PATH)/lib -lmosquitto

echo_service: clean
	gcc -g -pedantic -Wall -o echo_service mqtt.c llog.c echo_service.c \
		-I$(MOSQUITTO_PATH)/include/ -L$(MOSQUITTO_PATH)/lib -lmosquitto