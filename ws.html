<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<body>
</body>
<script>
	var counter = 0;
    var socket = new WebSocket('ws://127.0.0.1:8080/', ['mqtt-bridge-protocol']);
//    var socket = new WebSocket('ws://127.0.0.1:7681/', ['dumb-increment-protocol']);

    function sendMessage(socket, message) {
        console.log("sending message: " + message);
        socket.send(message);
    }

	// TODO reloading the browser should unsubscribe the client
    socket.onopen = function () {
    	//for(var i = 0; i < 100; i++) {
        	sendMessage(socket, 'SUBSCRIBE /foo/baz');
        	sendMessage(socket, 'UNSUBSCRIBE /foo/bar');
        	sendMessage(socket, 'PUBLISH /blub/blubber\nhello world');
        //}
    };

    socket.onmessage = function (event) {
    	document.body.innerHTML += '<p>' + counter + " : " + event.data + '</p>';
        console.log(event.data);
        counter++;
    };

</script>
</html>